services:
  stage-alert:
    build: .
    image: stage-alert-async:latest
    shm_size: 1gb
    #devices:
    #  - /dev/bus/usb:/dev/bus/usb
    environment:
      - TZ=America/Toronto
      - COOKIE=${COOKIE}
      - EMAIL=${EMAIL}
      - PASSWORD=${PASSWORD}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - DISCORD_CHANNEL_ID=${DISCORD_CHANNEL_ID}
      - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN}
      - DISCORD_ROLE_ID=${DISCORD_ROLE_ID}
      - POSTES_PATH=${POSTES_PATH:-/data/postes.csv}  # fallback if not set
      - CV_JSON=${CV_JSON}
    volumes:
      - data:/data
      - /run/pcscd:/run/pcscd
    restart: unless-stopped
volumes:
  data: {}

